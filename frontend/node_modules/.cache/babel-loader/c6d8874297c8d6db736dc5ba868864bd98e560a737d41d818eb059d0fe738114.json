{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BrowserProcessor = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nclass BrowserProcessor {\n  #browserCdpClient;\n  constructor(browserCdpClient) {\n    this.#browserCdpClient = browserCdpClient;\n  }\n  close() {\n    // Ensure that it is put at the end of the event loop.\n    // This way we send back the response before closing the tab.\n    setTimeout(() => this.#browserCdpClient.sendCommand('Browser.close'), 0);\n    return {};\n  }\n  async createUserContext(params) {\n    const request = {\n      proxyServer: params['goog:proxyServer'] ?? undefined\n    };\n    const proxyBypassList = params['goog:proxyBypassList'] ?? undefined;\n    if (proxyBypassList) {\n      request.proxyBypassList = proxyBypassList.join(',');\n    }\n    const context = await this.#browserCdpClient.sendCommand('Target.createBrowserContext', request);\n    return {\n      userContext: context.browserContextId\n    };\n  }\n  async removeUserContext(params) {\n    const userContext = params.userContext;\n    if (userContext === 'default') {\n      throw new protocol_js_1.InvalidArgumentException('`default` user context cannot be removed');\n    }\n    try {\n      await this.#browserCdpClient.sendCommand('Target.disposeBrowserContext', {\n        browserContextId: userContext\n      });\n    } catch (err) {\n      // https://source.chromium.org/chromium/chromium/src/+/main:content/browser/devtools/protocol/target_handler.cc;l=1424;drc=c686e8f4fd379312469fe018f5c390e9c8f20d0d\n      if (err.message.startsWith('Failed to find context with id')) {\n        throw new protocol_js_1.NoSuchUserContextException(err.message);\n      }\n      throw err;\n    }\n    return {};\n  }\n  async getUserContexts() {\n    const result = await this.#browserCdpClient.sendCommand('Target.getBrowserContexts');\n    return {\n      userContexts: [{\n        userContext: 'default'\n      }, ...result.browserContextIds.map(id => {\n        return {\n          userContext: id\n        };\n      })]\n    };\n  }\n}\nexports.BrowserProcessor = BrowserProcessor;","map":{"version":3,"names":["protocol_js_1","require","BrowserProcessor","browserCdpClient","constructor","close","setTimeout","sendCommand","createUserContext","params","request","proxyServer","undefined","proxyBypassList","join","context","userContext","browserContextId","removeUserContext","InvalidArgumentException","err","message","startsWith","NoSuchUserContextException","getUserContexts","result","userContexts","browserContextIds","map","id","exports"],"sources":["../../../../../src/bidiMapper/modules/browser/BrowserProcessor.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAmBA,MAAAA,aAAA,GAAAC,OAAA;AAQA,MAAaC,gBAAgB;EAClB,CAAAC,gBAAiB;EAE1BC,YAAYD,gBAA2B;IACrC,IAAI,CAAC,CAAAA,gBAAiB,GAAGA,gBAAgB;EAC3C;EAEAE,KAAKA,CAAA;IACH;IACA;IACAC,UAAU,CAAC,MAAM,IAAI,CAAC,CAAAH,gBAAiB,CAACI,WAAW,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;IAExE,OAAO,EAAE;EACX;EAEA,MAAMC,iBAAiBA,CACrBC,MAA2B;IAE3B,MAAMC,OAAO,GAAgD;MAC3DC,WAAW,EAAEF,MAAM,CAAC,kBAAkB,CAAC,IAAIG;KAC5C;IACD,MAAMC,eAAe,GACnBJ,MAAM,CAAC,sBAAsB,CAAC,IAAIG,SAAS;IAC7C,IAAIC,eAAe,EAAE;MACnBH,OAAO,CAACG,eAAe,GAAGA,eAAe,CAACC,IAAI,CAAC,GAAG,CAAC;IACrD;IACA,MAAMC,OAAO,GAAG,MAAM,IAAI,CAAC,CAAAZ,gBAAiB,CAACI,WAAW,CACtD,6BAA6B,EAC7BG,OAAO,CACR;IACD,OAAO;MACLM,WAAW,EAAED,OAAO,CAACE;KACtB;EACH;EAEA,MAAMC,iBAAiBA,CACrBT,MAA2C;IAE3C,MAAMO,WAAW,GAAGP,MAAM,CAACO,WAAW;IACtC,IAAIA,WAAW,KAAK,SAAS,EAAE;MAC7B,MAAM,IAAIhB,aAAA,CAAAmB,wBAAwB,CAChC,0CAA0C,CAC3C;IACH;IACA,IAAI;MACF,MAAM,IAAI,CAAC,CAAAhB,gBAAiB,CAACI,WAAW,CAAC,8BAA8B,EAAE;QACvEU,gBAAgB,EAAED;OACnB,CAAC;IACJ,CAAC,CAAC,OAAOI,GAAG,EAAE;MACZ;MACA,IAAKA,GAAa,CAACC,OAAO,CAACC,UAAU,CAAC,gCAAgC,CAAC,EAAE;QACvE,MAAM,IAAItB,aAAA,CAAAuB,0BAA0B,CAAEH,GAAa,CAACC,OAAO,CAAC;MAC9D;MACA,MAAMD,GAAG;IACX;IACA,OAAO,EAAE;EACX;EAEA,MAAMI,eAAeA,CAAA;IACnB,MAAMC,MAAM,GAAG,MAAM,IAAI,CAAC,CAAAtB,gBAAiB,CAACI,WAAW,CACrD,2BAA2B,CAC5B;IACD,OAAO;MACLmB,YAAY,EAAE,CACZ;QACEV,WAAW,EAAE;OACd,EACD,GAAGS,MAAM,CAACE,iBAAiB,CAACC,GAAG,CAAEC,EAAE,IAAI;QACrC,OAAO;UACLb,WAAW,EAAEa;SACd;MACH,CAAC,CAAC;KAEL;EACH;;AA1EFC,OAAA,CAAA5B,gBAAA,GAAAA,gBAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}