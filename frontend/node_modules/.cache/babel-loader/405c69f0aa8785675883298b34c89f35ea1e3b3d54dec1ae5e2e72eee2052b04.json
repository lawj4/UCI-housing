{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InputState = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst Mutex_js_1 = require(\"../../../utils/Mutex.js\");\nconst InputSource_js_1 = require(\"./InputSource.js\");\nclass InputState {\n  cancelList = [];\n  #sources = new Map();\n  #mutex = new Mutex_js_1.Mutex();\n  getOrCreate(id, type, subtype) {\n    let source = this.#sources.get(id);\n    if (!source) {\n      switch (type) {\n        case \"none\" /* SourceType.None */:\n          source = new InputSource_js_1.NoneSource();\n          break;\n        case \"key\" /* SourceType.Key */:\n          source = new InputSource_js_1.KeySource();\n          break;\n        case \"pointer\" /* SourceType.Pointer */:\n          {\n            let pointerId = subtype === \"mouse\" /* Input.PointerType.Mouse */ ? 0 : 2;\n            const pointerIds = new Set();\n            for (const [, source] of this.#sources) {\n              if (source.type === \"pointer\" /* SourceType.Pointer */) {\n                pointerIds.add(source.pointerId);\n              }\n            }\n            while (pointerIds.has(pointerId)) {\n              ++pointerId;\n            }\n            source = new InputSource_js_1.PointerSource(pointerId, subtype);\n            break;\n          }\n        case \"wheel\" /* SourceType.Wheel */:\n          source = new InputSource_js_1.WheelSource();\n          break;\n        default:\n          throw new protocol_js_1.InvalidArgumentException(`Expected \"${\"none\" /* SourceType.None */}\", \"${\"key\" /* SourceType.Key */}\", \"${\"pointer\" /* SourceType.Pointer */}\", or \"${\"wheel\" /* SourceType.Wheel */}\". Found unknown source type ${type}.`);\n      }\n      this.#sources.set(id, source);\n      return source;\n    }\n    if (source.type !== type) {\n      throw new protocol_js_1.InvalidArgumentException(`Input source type of ${id} is ${source.type}, but received ${type}.`);\n    }\n    return source;\n  }\n  get(id) {\n    const source = this.#sources.get(id);\n    if (!source) {\n      throw new protocol_js_1.UnknownErrorException(`Internal error.`);\n    }\n    return source;\n  }\n  getGlobalKeyState() {\n    const state = new InputSource_js_1.KeySource();\n    for (const [, source] of this.#sources) {\n      if (source.type !== \"key\" /* SourceType.Key */) {\n        continue;\n      }\n      for (const pressed of source.pressed) {\n        state.pressed.add(pressed);\n      }\n      state.alt ||= source.alt;\n      state.ctrl ||= source.ctrl;\n      state.meta ||= source.meta;\n      state.shift ||= source.shift;\n    }\n    return state;\n  }\n  get queue() {\n    return this.#mutex;\n  }\n}\nexports.InputState = InputState;","map":{"version":3,"names":["protocol_js_1","require","Mutex_js_1","InputSource_js_1","InputState","cancelList","sources","Map","mutex","Mutex","getOrCreate","id","type","subtype","source","get","NoneSource","KeySource","pointerId","pointerIds","Set","add","has","PointerSource","WheelSource","InvalidArgumentException","set","UnknownErrorException","getGlobalKeyState","state","pressed","alt","ctrl","meta","shift","queue","exports"],"sources":["../../../../../src/bidiMapper/modules/input/InputState.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}