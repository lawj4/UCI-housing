{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2024 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WorkerRealm = void 0;\nconst Realm_js_1 = require(\"./Realm.js\");\nclass WorkerRealm extends Realm_js_1.Realm {\n  #realmType;\n  #ownerRealms;\n  constructor(cdpClient, eventManager, executionContextId, logger, origin, ownerRealms, realmId, realmStorage, realmType) {\n    super(cdpClient, eventManager, executionContextId, logger, origin, realmId, realmStorage);\n    this.#ownerRealms = ownerRealms;\n    this.#realmType = realmType;\n    this.initialize();\n  }\n  get associatedBrowsingContexts() {\n    return this.#ownerRealms.flatMap(realm => realm.associatedBrowsingContexts);\n  }\n  get realmType() {\n    return this.#realmType;\n  }\n  get source() {\n    return {\n      realm: this.realmId,\n      // This is a hack to make Puppeteer able to track workers.\n      // TODO: remove after Puppeteer tracks workers by owners and use the base version.\n      context: this.associatedBrowsingContexts[0]?.id\n    };\n  }\n  get realmInfo() {\n    const owners = this.#ownerRealms.map(realm => realm.realmId);\n    const {\n      realmType\n    } = this;\n    switch (realmType) {\n      case 'dedicated-worker':\n        {\n          const owner = owners[0];\n          if (owner === undefined || owners.length !== 1) {\n            throw new Error('Dedicated worker must have exactly one owner');\n          }\n          return {\n            ...this.baseInfo,\n            type: realmType,\n            owners: [owner]\n          };\n        }\n      case 'service-worker':\n      case 'shared-worker':\n        {\n          return {\n            ...this.baseInfo,\n            type: realmType\n          };\n        }\n    }\n  }\n}\nexports.WorkerRealm = WorkerRealm;","map":{"version":3,"names":["Realm_js_1","require","WorkerRealm","Realm","realmType","ownerRealms","constructor","cdpClient","eventManager","executionContextId","logger","origin","realmId","realmStorage","initialize","associatedBrowsingContexts","flatMap","realm","source","context","id","realmInfo","owners","map","owner","undefined","length","Error","baseInfo","type","exports"],"sources":["../../../../../src/bidiMapper/modules/script/WorkerRealm.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAyBA,MAAAA,UAAA,GAAAC,OAAA;AAUA,MAAaC,WAAY,SAAQF,UAAA,CAAAG,KAAK;EAC3B,CAAAC,SAAU;EACV,CAAAC,WAAY;EAErBC,YACEC,SAAoB,EACpBC,YAA0B,EAC1BC,kBAAuD,EACvDC,MAA4B,EAC5BC,MAAc,EACdN,WAAoB,EACpBO,OAAqB,EACrBC,YAA0B,EAC1BT,SAA0B;IAE1B,KAAK,CACHG,SAAS,EACTC,YAAY,EACZC,kBAAkB,EAClBC,MAAM,EACNC,MAAM,EACNC,OAAO,EACPC,YAAY,CACb;IAED,IAAI,CAAC,CAAAR,WAAY,GAAGA,WAAW;IAC/B,IAAI,CAAC,CAAAD,SAAU,GAAGA,SAAS;IAE3B,IAAI,CAACU,UAAU,EAAE;EACnB;EAEA,IAAaC,0BAA0BA,CAAA;IACrC,OAAO,IAAI,CAAC,CAAAV,WAAY,CAACW,OAAO,CAC7BC,KAAK,IAAKA,KAAK,CAACF,0BAA0B,CAC5C;EACH;EAEA,IAAaX,SAASA,CAAA;IACpB,OAAO,IAAI,CAAC,CAAAA,SAAU;EACxB;EAEA,IAAac,MAAMA,CAAA;IACjB,OAAO;MACLD,KAAK,EAAE,IAAI,CAACL,OAAO;MACnB;MACA;MACAO,OAAO,EAAE,IAAI,CAACJ,0BAA0B,CAAC,CAAC,CAAC,EAAEK;KAC9C;EACH;EAEA,IAAaC,SAASA,CAAA;IACpB,MAAMC,MAAM,GAAG,IAAI,CAAC,CAAAjB,WAAY,CAACkB,GAAG,CAAEN,KAAK,IAAKA,KAAK,CAACL,OAAO,CAAC;IAC9D,MAAM;MAACR;IAAS,CAAC,GAAG,IAAI;IACxB,QAAQA,SAAS;MACf,KAAK,kBAAkB;QAAE;UACvB,MAAMoB,KAAK,GAAGF,MAAM,CAAC,CAAC,CAAC;UACvB,IAAIE,KAAK,KAAKC,SAAS,IAAIH,MAAM,CAACI,MAAM,KAAK,CAAC,EAAE;YAC9C,MAAM,IAAIC,KAAK,CAAC,8CAA8C,CAAC;UACjE;UACA,OAAO;YACL,GAAG,IAAI,CAACC,QAAQ;YAChBC,IAAI,EAAEzB,SAAS;YACfkB,MAAM,EAAE,CAACE,KAAK;WACf;QACH;MACA,KAAK,gBAAgB;MACrB,KAAK,eAAe;QAAE;UACpB,OAAO;YACL,GAAG,IAAI,CAACI,QAAQ;YAChBC,IAAI,EAAEzB;WACP;QACH;IACF;EACF;;AAzEF0B,OAAA,CAAA5B,WAAA,GAAAA,WAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}