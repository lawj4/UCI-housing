{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RealmStorage = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst WindowRealm_js_1 = require(\"./WindowRealm.js\");\n/** Container class for browsing realms. */\nclass RealmStorage {\n  /** Tracks handles and their realms sent to the client. */\n  #knownHandlesToRealmMap = new Map();\n  /** Map from realm ID to Realm. */\n  #realmMap = new Map();\n  get knownHandlesToRealmMap() {\n    return this.#knownHandlesToRealmMap;\n  }\n  addRealm(realm) {\n    this.#realmMap.set(realm.realmId, realm);\n  }\n  /** Finds all realms that match the given filter. */\n  findRealms(filter) {\n    return Array.from(this.#realmMap.values()).filter(realm => {\n      if (filter.realmId !== undefined && filter.realmId !== realm.realmId) {\n        return false;\n      }\n      if (filter.browsingContextId !== undefined && !realm.associatedBrowsingContexts.map(browsingContext => browsingContext.id).includes(filter.browsingContextId)) {\n        return false;\n      }\n      if (filter.sandbox !== undefined && (!(realm instanceof WindowRealm_js_1.WindowRealm) || filter.sandbox !== realm.sandbox)) {\n        return false;\n      }\n      if (filter.executionContextId !== undefined && filter.executionContextId !== realm.executionContextId) {\n        return false;\n      }\n      if (filter.origin !== undefined && filter.origin !== realm.origin) {\n        return false;\n      }\n      if (filter.type !== undefined && filter.type !== realm.realmType) {\n        return false;\n      }\n      if (filter.cdpSessionId !== undefined && filter.cdpSessionId !== realm.cdpClient.sessionId) {\n        return false;\n      }\n      return true;\n    });\n  }\n  findRealm(filter) {\n    const maybeRealms = this.findRealms(filter);\n    if (maybeRealms.length !== 1) {\n      return undefined;\n    }\n    return maybeRealms[0];\n  }\n  /** Gets the only realm that matches the given filter, if any, otherwise throws. */\n  getRealm(filter) {\n    const maybeRealm = this.findRealm(filter);\n    if (maybeRealm === undefined) {\n      throw new protocol_js_1.NoSuchFrameException(`Realm ${JSON.stringify(filter)} not found`);\n    }\n    return maybeRealm;\n  }\n  /** Deletes all realms that match the given filter. */\n  deleteRealms(filter) {\n    this.findRealms(filter).map(realm => {\n      realm.dispose();\n      this.#realmMap.delete(realm.realmId);\n      Array.from(this.knownHandlesToRealmMap.entries()).filter(([, r]) => r === realm.realmId).map(([handle]) => this.knownHandlesToRealmMap.delete(handle));\n    });\n  }\n}\nexports.RealmStorage = RealmStorage;","map":{"version":3,"names":["protocol_js_1","require","WindowRealm_js_1","RealmStorage","knownHandlesToRealmMap","Map","realmMap","addRealm","realm","set","realmId","findRealms","filter","Array","from","values","undefined","browsingContextId","associatedBrowsingContexts","map","browsingContext","id","includes","sandbox","WindowRealm","executionContextId","origin","type","realmType","cdpSessionId","cdpClient","sessionId","findRealm","maybeRealms","length","getRealm","maybeRealm","NoSuchFrameException","JSON","stringify","deleteRealms","dispose","delete","entries","r","handle","exports"],"sources":["../../../../../src/bidiMapper/modules/script/RealmStorage.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}